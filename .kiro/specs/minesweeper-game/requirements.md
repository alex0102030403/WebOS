# Requirements Document

## Introduction

This document defines the requirements for a server-authoritative Minesweeper game integrated into the WebOS Portfolio. The game demonstrates secure backend architecture where all game logic resides on the server, ensuring the client never has access to mine locations until cells are revealed through user interaction.

## Glossary

- **Grid_State**: The internal 10x10 2D array representing the game board, where 9 indicates a mine and 0-8 indicates adjacent mine count
- **Session_ID**: A UUID generated by the client and stored in localStorage to identify game sessions
- **Game_State_Manager**: A singleton service managing active game sessions using a ConcurrentHashMap
- **Masked_Grid**: The client-visible representation of the grid showing only revealed cells
- **Cell_Update**: A data structure containing row, column, and revealed value for a single cell
- **Flood_Fill**: Recursive algorithm to auto-reveal adjacent blank cells when a zero-cell is clicked

## Requirements

### Requirement 1: Game Session Management

**User Story:** As a player, I want to start a new Minesweeper game with a unique session, so that my game state is preserved and isolated from other players.

#### Acceptance Criteria

1. WHEN a client sends a POST request to `/games/minesweeper/new` with a session ID, THE Game_State_Manager SHALL create a new Grid_State and store it with the session ID as key
2. WHEN a new game is created, THE System SHALL return an empty 10x10 Masked_Grid to the client with all cells hidden
3. WHEN a session ID already exists, THE Game_State_Manager SHALL replace the existing Grid_State with a new one
4. THE Game_State_Manager SHALL use a ConcurrentHashMap to ensure thread-safe access to game sessions

### Requirement 2: Grid Initialization

**User Story:** As a player, I want the game board to be randomly generated with mines, so that each game provides a unique challenge.

#### Acceptance Criteria

1. WHEN a new Grid_State is created, THE System SHALL initialize a 10x10 grid with randomly placed mines
2. THE Grid_State SHALL contain exactly 10 mines placed at random positions
3. WHEN mines are placed, THE System SHALL calculate and store adjacent mine counts (0-8) for all non-mine cells
4. THE Grid_State SHALL use value 9 to represent mine cells internally

### Requirement 3: Cell Click Processing

**User Story:** As a player, I want to click on cells to reveal their contents, so that I can progress through the game.

#### Acceptance Criteria

1. WHEN a client sends a POST request to `/games/minesweeper/click` with session ID, row, and column, THE System SHALL process the click and return only revealed cell updates
2. WHEN a mine cell is clicked, THE System SHALL mark the game as LOST and return the mine location in updates
3. WHEN a numbered cell (1-8) is clicked, THE System SHALL reveal only that cell's value
4. WHEN a blank cell (0) is clicked, THE System SHALL use Flood_Fill to auto-reveal all adjacent blank cells and their numbered borders
5. IF an invalid session ID is provided, THEN THE System SHALL return an error response

### Requirement 4: Security Protocol

**User Story:** As a system architect, I want the server to never expose hidden mine locations, so that the game cannot be cheated by inspecting network traffic.

#### Acceptance Criteria

1. THE API response SHALL only contain Cell_Update entries for cells that have been revealed by the current or previous clicks
2. THE API response SHALL never include the full Grid_State or positions of unrevealed mines
3. THE response format SHALL be `{"status": "PLAYING|LOST|WON", "updates": [{"r": row, "c": col, "val": value}, ...]}`
4. WHEN the game status is LOST, THE System SHALL only reveal the clicked mine, not all mines on the board

### Requirement 5: Win Condition Detection

**User Story:** As a player, I want to know when I've won the game, so that I can celebrate my victory.

#### Acceptance Criteria

1. WHEN all non-mine cells have been revealed, THE System SHALL mark the game as WON
2. WHEN the game is WON, THE System SHALL return status "WON" in the response
3. THE System SHALL track revealed cell count to efficiently detect win condition

### Requirement 6: Frontend Game Interface

**User Story:** As a player, I want a visual Minesweeper interface in the WebOS desktop, so that I can play the game intuitively.

#### Acceptance Criteria

1. WHEN the Minesweeper app is opened, THE Frontend SHALL generate a UUID session ID and store it in localStorage
2. WHEN the app mounts, THE Frontend SHALL call `/games/minesweeper/new` and render a 10x10 grid of gray buttons
3. WHEN a cell button is clicked, THE Frontend SHALL send coordinates to `/games/minesweeper/click` and update only the cells returned in the response
4. WHEN the game status is LOST, THE Frontend SHALL disable all cell buttons and display a game over indicator
5. WHEN the game status is WON, THE Frontend SHALL display a victory indicator
6. THE Frontend SHALL display numbers (1-8) with distinct colors and a bomb icon for revealed mines

### Requirement 7: Flag Marking (Optional Enhancement)

**User Story:** As a player, I want to right-click cells to mark suspected mines with flags, so that I can track my deductions.

#### Acceptance Criteria

1. WHEN a player right-clicks an unrevealed cell, THE Frontend SHALL toggle a flag marker on that cell
2. WHEN a cell is flagged, THE Frontend SHALL prevent left-click reveals on that cell
3. THE flag state SHALL be managed entirely on the frontend without server communication
